CREATE TABLE PILOT (
    ENUM INT(3),
    LICENSE VARCHAR(5),
    RATING VARCHAR(25),
    MED_TYPE CHAR(1),
    MED_DATE DATE,
    PT135_DATE DATE
);

CREATE TABLE EMPLOYEE5 (
    ENUM INT(3),
    TITLE CHAR(3),
    LNAME VARCHAR(15),
    FNAME VARCHAR(15),
    INITIAL CHAR(1),
    DOB DATE,
    HIRE_DATE DATE
);

CREATE TABLE AIRCRAFT (
    AC_NUMBER CHAR(5),
    MOD_CODE VARCHAR(10),
    AC_TTAF DECIMAL(6,1),
    AC_TTEL DECIMAL(6,1),
    AC_TIER DECIMAL(6,1)
);

CREATE TABLE CHARTER (
    CTR_TRIP INT(5),
    CTR_DATE DATE,
    CTR_PILOT INT(3),
    CTR_COPILOT INT(3),
    AC_NUMBER CHAR(5),
    CTR_DESTINATION CHAR(3),
    CTR_DISTANCE INT(4),
    HRS_FLOWN DECIMAL(3,1),
    HRS_WAIT DECIMAL(3,1),
    FUEL_GALLONS DECIMAL(5,1),
    CTR_OIL_QTS INT,
    CODE INT(5)
);

CREATE TABLE CUSTOMER (
    CODE INT(5),
    CLNAME VARCHAR(15),
    CFNAME VARCHAR(15),
    CAREACODE INT(3),
    CPHONE CHAR(8),
    CBALANCE DECIMAL(7,2)
);

CREATE TABLE MODEL (
    MCODE VARCHAR(10),
    M_MFGR VARCHAR(15),
    M_NAME VARCHAR(20),
    M_SEATS INT(2),
    M_CHG_MILE DECIMAL(4,2)
);
-- Sample data for PILOT table
INSERT INTO PILOT (ENUM, LICENSE, RATING, MED_TYPE, MED_DATE, PT135_DATE)
VALUES
(101, 'P001', 'Commercial Pilot', 'A', '2023-01-15', '2023-01-10'),
(102, 'P002', 'Private Pilot', 'B', '2023-02-20', '2023-02-15'),
(103, 'P003', 'Flight Instructor', 'C', '2023-03-25', '2023-03-20'),
(104, 'P004', 'Airline Transport Pilot', 'A', '2023-04-30', '2023-04-25'),
(105, 'P005', 'Commercial Pilot', 'B', '2023-05-05', '2023-05-01'),
(106, 'P006', 'Private Pilot', 'C', '2023-06-10', '2023-06-05');

-- Sample data for EMPLOYEE table
INSERT INTO EMPLOYEE5 (ENUM, TITLE, LNAME, FNAME, INITIAL, DOB, HIRE_DATE)
VALUES
(201, 'Mgr', 'Smith', 'John', 'M', '1980-05-15', '2005-02-20'),
(202, 'Eng', 'Johnson', 'Emily', 'E', '1985-08-20', '2010-03-10'),
(203, 'Acc', 'Williams', 'Michael', 'W', '1990-11-25', '2015-06-15'),
(204, 'Adm', 'Brown', 'Emma', 'B', '1995-04-30', '2020-09-25'),
(205, 'Sal', 'Jones', 'Daniel', 'J', '2000-07-05', '2021-11-01'),
(206, 'Eng', 'Davis', 'Olivia', 'D', '2005-10-10', '2022-12-10');

-- Sample data for AIRCRAFT table
INSERT INTO AIRCRAFT (AC_NUMBER, MOD_CODE, AC_TTAF, AC_TTEL, AC_TIER)
VALUES
('A001', 'M001', 2500.5, 1500.2, 800.3),
('A002', 'M002', 1800.7, 1000.9, 500.1),
('A003', 'M003', 3200.3, 2000.6, 1200.9),
('A004', 'M001', 1900.8, 1100.4, 600.7),
('A005', 'M002', 2700.6, 1600.3, 900.5),
('A006', 'M003', 3000.4, 1800.5, 1000.2);

-- Sample data for CHARTER table
INSERT INTO CHARTER (CTR_TRIP, CTR_DATE, CTR_PILOT, CTR_COPILOT, AC_NUMBER, CTR_DESTINATION, CTR_DISTANCE, HRS_FLOWN, HRS_WAIT, FUEL_GALLONS, CTR_OIL_QTS, CODE)
VALUES
(1001, '2023-01-05', 101, 102, 'A001', 'XYZ', 500, 5.5, 1.2, 100.5, 2, 301),
(1002, '2023-02-10', 103, 104, 'A002', 'ABC', 600, 6.0, 1.0, 120.0, 3, 302),
(1003, '2023-03-15', 105, 106, 'A003', 'DEF', 700, 6.5, 0.8, 150.5, 2, 303),
(1004, '2023-04-20', 101, 103, 'A004', 'GHI', 800, 7.0, 0.5, 170.0, 3, 304),
(1005, '2023-05-25', 104, 106, 'A005', 'JKL', 900, 7.5, 0.3, 180.5, 1, 305),
(1006, '2023-06-30', 102, 105, 'A006', 'MNO', 1000, 8.0, 0.2, 200.0, 2, 306);

-- Sample data for CUSTOMER table
INSERT INTO CUSTOMER (CODE, CLNAME, CFNAME, CAREACODE, CPHONE, CBALANCE)
VALUES
(301, 'Anderson', 'Sarah', 101, '12345678', 5000.50),
(302, 'Wilson', 'David', 102, '23456789', 6000.75),
(303, 'Martinez', 'Maria', 103, '34567890', 7000.25),
(304, 'Taylor', 'James', 104, '45678901', 8000.00),
(305, 'Thomas', 'Jennifer', 105, '56789012', 9000.00),
(306, 'Hernandez', 'Carlos', 106, '67890123', 10000.50);

-- Sample data for MODEL table
INSERT INTO MODEL (MCODE, M_MFGR, M_NAME, M_SEATS, M_CHG_MILE)
VALUES
('M001', 'Boeing', '737', 150, 0.05),
('M002', 'Airbus', 'A320', 180, 0.04),
('M003', 'Embraer', 'ERJ-145', 50, 0.06);


SELECT CTR_DATE, AC_NUMBER, CTR_DESTINATION, CTR_DISTANCE, HRS_FLOWN
FROM CHARTER
WHERE AC_NUMBER = 'A003';

CREATE VIEW A AS
SELECT CTR_DATE, AC_NUMBER, CTR_DESTINATION, CTR_DISTANCE, HRS_FLOWN
FROM CHARTER
WHERE AC_NUMBER = 'A003';

SELECT C.CTR_DATE, CUS.CPHONE, C.AC_NUMBER, CUS.CAREACODE, C.CTR_DESTINATION, C.CODE
FROM CHARTER C
JOIN CUSTOMER CUS ON C.CODE = CUS.CODE;

SELECT C.CTR_DATE, C.AC_NUMBER, M.M_NAME, E.LNAME
FROM CHARTER C
JOIN AIRCRAFT A ON C.AC_NUMBER = A.AC_NUMBER
JOIN MODEL M ON A.MOD_CODE = M.MCODE
JOIN EMPLOYEE E ON C.CTR_PILOT = E.ENUM
WHERE C.AC_NUMBER = 'A003';

SELECT CODE, CLNAME, CFNAME, CBALANCE
FROM CUSTOMER
WHERE CBALANCE > 0
ORDER BY CBALANCE DESC;

SELECT AVG(CBALANCE) AS Avg_Balance,
       MIN(CBALANCE) AS Min_Balance,
       MAX(CBALANCE) AS Max_Balance,
       SUM(CBALANCE) AS Total_Unpaid_Balance
FROM CUSTOMER
WHERE CBALANCE > 0;

SELECT AC_NUMBER,
       COUNT(*) AS Number_of_Trips,
       SUM(CTR_DISTANCE) AS Total_Distance,
       AVG(CTR_DISTANCE) AS Average_Distance,
       SUM(HRS_FLOWN) AS Total_Hours,
       AVG(HRS_FLOWN) AS Average_Hours
FROM CHARTER
GROUP BY AC_NUMBER;

SELECT CTR_DATE,  M_NAME, CTR_PILOT, LNAME, HRS_FLOWN
FROM CHARTER C
JOIN AIRCRAFT A ON C.AC_NUMBER = A.AC_NUMBER
JOIN MODEL M ON A.MOD_CODE = M.MCODE
JOIN EMPLOYEE E ON C.CTR_PILOT = E.ENUM
WHERE C.CTR_COPILOT IS NULL;


UPDATE AIRCRAFT
SET AC_TTAF = AC_TTAF + (SELECT SUM(HRS_FLOWN) FROM CHARTER WHERE CHARTER.AC_NUMBER = AIRCRAFT.AC_NUMBER),
    AC_TTEL = AC_TTEL + (SELECT SUM(HRS_FLOWN) FROM CHARTER WHERE CHARTER.AC_NUMBER = AIRCRAFT.AC_NUMBER),
    AC_TIER = AC_TIER + (SELECT SUM(HRS_FLOWN) FROM CHARTER WHERE CHARTER.AC_NUMBER = AIRCRAFT.AC_NUMBER)
WHERE AC_NUMBER = 'A003';



CREATE TRIGGER TRG_CTR_HRS AFTER INSERT ON CHARTER
FOR EACH ROW
UPDATE AIRCRAFT A
    SET A.AC_TTAF = A.AC_TTAF + NEW.HRS_FLOWN,
	A.AC_TTEL = A.AC_TTEL + NEW.HRS_FLOWN,
	A.AC_TIER = A.AC_TIER + NEW.HRS_FLOWN
    WHERE A.AC_NUMBER = NEW.AC_NUMBER;